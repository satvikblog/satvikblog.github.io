{"title":"SSRF Walkthrough - THM","uid":"6937fd4b35dfe494a27e1637f94b0a2f","slug":"THM/WEB/SSRF-Walkthrough-THM","date":"2024-06-07T13:14:36.000Z","updated":"2024-06-07T17:30:48.641Z","comments":true,"path":"api/articles/THM/WEB/SSRF-Walkthrough-THM.json","keywords":null,"cover":"https://tryhackme-images.s3.amazonaws.com/room-icons/268e10b8ee0b53d1074b2a7fd5b1a789.png","content":"<p><strong>Hello Hackers</strong> 💌<br><strong>Today we are gonna walkthrough a new room in <code>Web Fundamentals</code> called <code>SSRF</code> on #TryHackMe</strong><br><strong>Lets start</strong> 🚀</p>\n<a href=\"https://notes.satvik.live/thm-notes/web-fundamentals-path/ssrf-room/\" style=\"text-decoration:none;\">\n  <button style=\"\n    background: linear-gradient(90deg, rgba(0,123,255,1) 0%, rgba(0,102,204,1) 100%);\n    border: none; /* Remove borders */\n    color: white; /* White text */\n    padding: 10px 20px; /* Some padding */\n    text-align: center; /* Centered text */\n    text-decoration: none; /* Remove underline */\n    display: flex; /* Use flexbox */\n    align-items: center; /* Center items vertically */\n    justify-content: center; /* Center items horizontally */\n    font-size: 16px; /* Increase font size */\n    margin: 4px 2px; /* Add some margin */\n    cursor: pointer; /* Add a pointer on hover */\n    border-radius: 12px; /* Rounded corners */\n    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Add shadow */\n    transition: transform 0.2s; /* Animation for hover effect */\n    height: 40px; /* Fixed height for better alignment */\n  \" onmouseover=\"this.style.transform='scale(1.05)';\" onmouseout=\"this.style.transform='scale(1.0)';\">\n    View notes 👀\n  </button>\n</a>\n\n<hr>\n<h1 id=\"TASK-1-What-is-an-SSRF\"><a href=\"#TASK-1-What-is-an-SSRF\" class=\"headerlink\" title=\"TASK 1 - What is an SSRF ?\"></a>TASK 1 - What is an SSRF ?</h1><p><strong>Room Brief</strong></p>\n<p>In this room, you’ll learn what an SSRF is, what kind of impact they can have, you’ll view some example SSRF attacks, how you can discover SSRF vulnerabilities, how to circumvent input rules and then we have a practice for you against with to try your newfound skills.</p>\n<p><strong>What is an SSRF?</strong></p>\n<p>SSRF stands for Server-Side Request Forgery. It’s a vulnerability that allows a malicious user to cause the webserver to make an additional or edited HTTP request to the resource of the attacker’s choosing.</p>\n<p><strong>Types of SSRF</strong></p>\n<p>There are two types of SSRF vulnerability; the first is a regular SSRF where data is returned to the attacker’s screen. The second is a Blind SSRF vulnerability where an SSRF occurs, but no information is returned to the attacker’s screen.</p>\n<p><strong>What’s the impact?</strong><br>A successful SSRF attack can result in any of the following: </p>\n<p>Access to unauthorised areas.<br>Access to customer&#x2F;organisational data.<br>Ability to Scale to internal networks.<br>Reveal authentication tokens&#x2F;credentials.</p>\n<h2 id=\"Answer-the-questions-below\"><a href=\"#Answer-the-questions-below\" class=\"headerlink\" title=\"Answer the questions below\"></a>Answer the questions below</h2><p><strong>1. What does SSRF stand for?</strong><br>Answer: <code>Server-Side Request Forgery</code></p>\n<p><strong>2. As opposed to a regular SSRF, what is the other type?</strong><br>Answer: <code>Blind</code></p>\n<hr>\n<h1 id=\"SSRF-Examples\"><a href=\"#SSRF-Examples\" class=\"headerlink\" title=\"SSRF Examples\"></a>SSRF Examples</h1><p>Click the View Site button, which will take you through some common SSRF examples, how to exploit them and even a simulation to see if you can take advantage of an SSRF vulnerability using what you’ve learnt.</p>\n<h2 id=\"Answer-the-questions-below-1\"><a href=\"#Answer-the-questions-below-1\" class=\"headerlink\" title=\"Answer the questions below\"></a>Answer the questions below</h2><p><strong>1. What is the flag from the SSRF Examples site?</strong></p>\n<ul>\n<li><p>In the address bar in the excercise you need to put this : <a href=\"https://website.thm/item/2?server=server.website.thm/flag?id=9&x\">https://website.thm/item/2?server=server.website.thm/flag?id=9&amp;x</a></p>\n</li>\n<li><p>Answer: <code>THM&#123;SSRF_MASTER&#125;</code></p>\n</li>\n</ul>\n<hr>\n<h1 id=\"Finding-an-SSRF\"><a href=\"#Finding-an-SSRF\" class=\"headerlink\" title=\"Finding an SSRF\"></a>Finding an SSRF</h1><p>Potential SSRF vulnerabilities can be spotted in web applications in many different ways. Here is an example of four common places to look:</p>\n<p>When a full URL is used in a parameter in the address bar:</p>\n<p><img src=\"https://tryhackme-images.s3.amazonaws.com/user-uploads/5efe36fb68daf465530ca761/room-content/956e1914b116cbc9e564e3bb3d9ab50a.png\" alt=\"i\"></p>\n<p>A hidden field in a form:</p>\n<p><img src=\"https://tryhackme-images.s3.amazonaws.com/user-uploads/5efe36fb68daf465530ca761/room-content/237696fc8e405d25d4fc7bbcc67919f0.png\" alt=\"i\"></p>\n<p>A partial URL such as just the hostname:</p>\n<p><img src=\"https://tryhackme-images.s3.amazonaws.com/user-uploads/5efe36fb68daf465530ca761/room-content/f3c387849e91a4f15a7b59ff7324be75.png\" alt=\"i\"></p>\n<p>Or perhaps only the path of the URL:</p>\n<p><img src=\"https://tryhackme-images.s3.amazonaws.com/user-uploads/5efe36fb68daf465530ca761/room-content/3fd583950617f7a3713a107fcb4cfa49.png\" alt=\"i\"></p>\n<p>Some of these examples are easier to exploit than others, and this is where a lot of trial and error will be required to find a working payload.</p>\n<p>If working with a blind SSRF where no output is reflected back to you, you’ll need to use an external HTTP logging tool to monitor requests such as requestbin.com, your own HTTP server or Burp Suite’s Collaborator client.</p>\n<h2 id=\"Answer-the-questions-below-2\"><a href=\"#Answer-the-questions-below-2\" class=\"headerlink\" title=\"Answer the questions below\"></a>Answer the questions below</h2><p><strong>1. What website can be used to catch HTTP requests from a server?</strong><br>Answer: <code>requestbin.com</code></p>\n<hr>\n<h1 id=\"TASK-4-Defeating-Common-SSRF-Defenses\"><a href=\"#TASK-4-Defeating-Common-SSRF-Defenses\" class=\"headerlink\" title=\"TASK 4 - Defeating Common SSRF Defenses\"></a>TASK 4 - Defeating Common SSRF Defenses</h1><p>More security-savvy developers aware of the risks of SSRF vulnerabilities may implement checks in their applications to make sure the requested resource meets specific rules. There are usually two approaches to this, either a deny list or an allow list.</p>\n<p><strong>Deny List</strong></p>\n<p>A Deny List is where all requests are accepted apart from resources specified in a list or matching a particular pattern. A Web Application may employ a deny list to protect sensitive endpoints, IP addresses or domains from being accessed by the public while still allowing access to other locations. A specific endpoint to restrict access is the localhost, which may contain server performance data or further sensitive information, so domain names such as localhost and 127.0.0.1 would appear on a deny list. Attackers can bypass a Deny List by using alternative localhost references such as 0, 0.0.0.0, 0000, 127.1, 127.<em>.</em>.*, 2130706433, 017700000001 or subdomains that have a DNS record which resolves to the IP Address 127.0.0.1 such as 127.0.0.1.nip.io.</p>\n<p>Also, in a cloud environment, it would be beneficial to block access to the IP address 169.254.169.254, which contains metadata for the deployed cloud server, including possibly sensitive information. An attacker can bypass this by registering a subdomain on their own domain with a DNS record that points to the IP Address 169.254.169.254.</p>\n<p><strong>Allow List</strong></p>\n<p>An allow list is where all requests get denied unless they appear on a list or match a particular pattern, such as a rule that an URL used in a parameter must begin with <a href=\"https://website.thm/\">https://website.thm</a>. An attacker could quickly circumvent this rule by creating a subdomain on an attacker’s domain name, such as <a href=\"https://website.thm.attackers-domain.thm/\">https://website.thm.attackers-domain.thm</a>. The application logic would now allow this input and let an attacker control the internal HTTP request.</p>\n<p><strong>Open Redirect</strong></p>\n<p>If the above bypasses do not work, there is one more trick up the attacker’s sleeve, the open redirect. An open redirect is an endpoint on the server where the website visitor gets automatically redirected to another website address. Take, for example, the link <a href=\"https://website.thm/link?url=https://tryhackme.com\">https://website.thm/link?url=https://tryhackme.com</a>. This endpoint was created to record the number of times visitors have clicked on this link for advertising&#x2F;marketing purposes. But imagine there was a potential SSRF vulnerability with stringent rules which only allowed URLs beginning with <a href=\"https://website.thm/\">https://website.thm/</a>. An attacker could utilise the above feature to redirect the internal HTTP request to a domain of the attacker’s choice.</p>\n<h2 id=\"Answer-the-questions-below-3\"><a href=\"#Answer-the-questions-below-3\" class=\"headerlink\" title=\"Answer the questions below\"></a>Answer the questions below</h2><p><strong>1. What method can be used to bypass strict rules?</strong><br>Answer: <code>Open Redirect</code></p>\n<p><strong>2. What IP address may contain sensitive data in a cloud environment?</strong></p>\n<p>Answer: <code>169.254.169.254</code></p>\n<p><strong>3. What type of list is used to permit only certain input?</strong></p>\n<p>Answer: <code>Allow List</code></p>\n<p><strong>4. What type of list is used to stop certain input?</strong></p>\n<p>Answer: <code>Deny List</code></p>\n<hr>\n<h1 id=\"TASK-5-SSRF-Practical\"><a href=\"#TASK-5-SSRF-Practical\" class=\"headerlink\" title=\"TASK 5 - SSRF Practical\"></a>TASK 5 - SSRF Practical</h1><p>Let’s put what we’ve learnt about SSRF to the test in a fictional scenario.</p>\n<p>We’ve come across two new endpoints during a content discovery exercise against the Acme IT Support website. The first one is &#x2F;private, which gives us an error message explaining that the contents cannot be viewed from our IP address. The second is a new version of the customer account page at &#x2F;customers&#x2F;new-account-page with a new feature allowing customers to choose an avatar for their account.</p>\n<p>Begin by clicking the Start Machine button to launch the Acme IT Support website. Once running, visit it at the URL <a href=\"https://lab_web_url.p.thmlabs.com/\">https://LAB_WEB_URL.p.thmlabs.com</a> and then follow the below instructions to get the flag.</p>\n<p>First, create a customer account and sign in. Once you’ve signed in, visit <a href=\"https://lab_web_url.p.thmlabs.com/customers/new-account-page\">https://LAB_WEB_URL.p.thmlabs.com/customers/new-account-page</a> to view the new avatar selection feature. By viewing the page source of the avatar form, you’ll see the avatar form field value contains the path to the image. The background-image style can confirm this in the above DIV element as per the screenshot below:</p>\n<p><img src=\"https://tryhackme-images.s3.amazonaws.com/user-uploads/5efe36fb68daf465530ca761/room-content/bd9ee9ac0b7592b5343cbc8dd9b57189.png\" alt=\"i\"></p>\n<p>If you choose one of the avatars and then click the Update Avatar button, you’ll see the form change and, above it, display your currently selected avatar.</p>\n<p><img src=\"https://tryhackme-images.s3.amazonaws.com/user-uploads/5c549500924ec576f953d9fc/room-content/8685bf7a4b24616031425a7f5e8db1ae.png\" alt=\"i\"></p>\n<p>Viewing the page source will show your current avatar is displayed using the data URI scheme, and the image content is base64 encoded as per the screenshot below.</p>\n<p><img src=\"https://tryhackme-images.s3.amazonaws.com/user-uploads/5efe36fb68daf465530ca761/room-content/fff0ea113602635dcf5d1e8d0b1d8bca.png\" alt=\"i\"></p>\n<p>Now let’s try making the request again but changing the avatar value to private in hopes that the server will access the resource and get past the IP address block. To do this, firstly, right-click on one of the radio buttons on the avatar form and select Inspect:</p>\n<p><img src=\"https://tryhackme-images.s3.amazonaws.com/user-uploads/5efe36fb68daf465530ca761/room-content/2ef87608418e47625bedad9d0361ed08.png\" alt=\"i\"></p>\n<p>And then edit the value of the radio button to private:</p>\n<p><a href=\"https://tryhackme-images.s3.amazonaws.com/user-uploads/5efe36fb68daf465530ca761/room-content/a1712298679cc642d792d935b14effe5.png\">https://tryhackme-images.s3.amazonaws.com/user-uploads/5efe36fb68daf465530ca761/room-content/a1712298679cc642d792d935b14effe5.png</a></p>\n<p>Be sure to select the avatar you edited and then click the Update Avatar button. Unfortunately, it looks like the web application has a deny list in place and has blocked access to the &#x2F;private endpoint.</p>\n<p><img src=\"https://tryhackme-images.s3.amazonaws.com/user-uploads/5efe36fb68daf465530ca761/room-content/a59460cc19eaf5776ee8a882e25b2d64.png\" alt=\"i\"></p>\n<p>As you can see from the error message, the path cannot start with &#x2F;private but don’t worry, we’ve still got a trick up our sleeve to bypass this rule. We can use a directory traversal trick to reach our desired endpoint. Try setting the avatar value to x&#x2F;..&#x2F;private</p>\n<p><img src=\"https://tryhackme-images.s3.amazonaws.com/user-uploads/5efe36fb68daf465530ca761/room-content/84b88d9c6fa6a29450520625bb42870d.png\" alt=\"i\"></p>\n<p>You’ll see we have now bypassed the rule, and the user updated the avatar. This trick works because when the web server receives the request for x&#x2F;..&#x2F;private, it knows that the ..&#x2F; string means to move up a directory that now translates the request to just &#x2F;private.</p>\n<p>Viewing the page source of the avatar form, you’ll see the currently set avatar now contains the contents from the &#x2F;private directory in base64 encoding, decode this content and it will reveal a flag that you can enter below.</p>\n<h2 id=\"Answer-the-questions-below-4\"><a href=\"#Answer-the-questions-below-4\" class=\"headerlink\" title=\"Answer the questions below\"></a>Answer the questions below</h2><p><strong>1. What is the flag from the &#x2F;private directory?</strong></p>\n<p>Answer: </p>\n<ul>\n<li>Follow the steps in the task carefully</li>\n<li>Now you will find the hash in the source code if you did all the things correctly</li>\n<li>Now decode the hash using the Cyberchef tool or anyother tool you know</li>\n</ul>\n<p><img src=\"https://dl.dropbox.com/scl/fi/eq1nkkt87wzuqqckwip26/c6.png?rlkey=91i09n8bwlw81yrw58csmpemm&st=g6chr3bh&dl=0\" alt=\"c6\"></p>\n<ul>\n<li>Flag : <code>THM&#123;YOU_WORKED_OUT_THE_SSRF&#125;</code></li>\n</ul>\n<p><strong>Thank You</strong> 💌<br><strong>Author:</strong> <code>Satvik Shetty</code>🧑‍💻<br><strong>See you again in another writeup</strong></p>\n","text":"Hello Hackers 💌Today we are gonna walkthrough a new room in Web Fundamentals cal...","permalink":"/post/THM/WEB/SSRF-Walkthrough-THM","photos":[],"count_time":{"symbolsCount":"8.8k","symbolsTime":"8 mins."},"categories":[{"name":"cybersecurity","slug":"cybersecurity","count":21,"path":"api/categories/cybersecurity.json"},{"name":"THM","slug":"cybersecurity/THM","count":20,"path":"api/categories/cybersecurity/THM.json"},{"name":"web","slug":"cybersecurity/THM/web","count":13,"path":"api/categories/cybersecurity/THM/web.json"}],"tags":[{"name":"tryhackme","slug":"tryhackme","count":20,"path":"api/tags/tryhackme.json"},{"name":"web","slug":"web","count":13,"path":"api/tags/web.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#TASK-1-What-is-an-SSRF\"><span class=\"toc-text\">TASK 1 - What is an SSRF ?</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Answer-the-questions-below\"><span class=\"toc-text\">Answer the questions below</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#SSRF-Examples\"><span class=\"toc-text\">SSRF Examples</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Answer-the-questions-below-1\"><span class=\"toc-text\">Answer the questions below</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#Finding-an-SSRF\"><span class=\"toc-text\">Finding an SSRF</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Answer-the-questions-below-2\"><span class=\"toc-text\">Answer the questions below</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#TASK-4-Defeating-Common-SSRF-Defenses\"><span class=\"toc-text\">TASK 4 - Defeating Common SSRF Defenses</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Answer-the-questions-below-3\"><span class=\"toc-text\">Answer the questions below</span></a></li></ol></li><li class=\"toc-item toc-level-1\"><a class=\"toc-link\" href=\"#TASK-5-SSRF-Practical\"><span class=\"toc-text\">TASK 5 - SSRF Practical</span></a><ol class=\"toc-child\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#Answer-the-questions-below-4\"><span class=\"toc-text\">Answer the questions below</span></a></li></ol></li></ol>","author":{"name":"Satvik.V","slug":"blog-author","avatar":"https://dl.dropbox.com/scl/fi/00hpz9sf96v4gugpvx7t9/profile.jpg?rlkey=yet0g0rb9ofkl806vvhmkjail&st=3rw0pj88&dl=0","link":"https://dl.dropbox.com/scl/fi/00hpz9sf96v4gugpvx7t9/profile.jpg?rlkey=yet0g0rb9ofkl806vvhmkjail&st=3rw0pj88&dl=0","description":"An Aspiring Penetration Tester & a security Enthusiast 🚀 127.0.0.1 / sudo rm -rf / 😁 Dont Drink and Root 👀","socials":{"github":"https://github.com/satvikblog","twitter":"https://twitter.com/anonbash1","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"instagram":{"icon":"fab fa-instagram","link":"https://instagram.com/satvikshetty.v"}}}},"mapped":true,"hidden":false,"prev_post":{"title":"Intro to Cross Site Scripting","uid":"a4a70e8c6575b56163e1d8803d527b20","slug":"THM/WEB/Intro-to-Cross-Site-Scripting","date":"2024-06-08T16:41:38.000Z","updated":"2024-06-09T17:49:24.964Z","comments":true,"path":"api/articles/THM/WEB/Intro-to-Cross-Site-Scripting.json","keywords":null,"cover":"https://tryhackme-images.s3.amazonaws.com/room-icons/c1c509a263e7a42bece2f0b77fd1ba1b.png","text":"Hello Hackers 💌Today we are gonna walkthrough a new room in Web Fundamentals cal...","permalink":"/post/THM/WEB/Intro-to-Cross-Site-Scripting","photos":[],"count_time":{"symbolsCount":"22k","symbolsTime":"20 mins."},"categories":[{"name":"cybersecurity","slug":"cybersecurity","count":21,"path":"api/categories/cybersecurity.json"},{"name":"THM","slug":"cybersecurity/THM","count":20,"path":"api/categories/cybersecurity/THM.json"},{"name":"web","slug":"cybersecurity/THM/web","count":13,"path":"api/categories/cybersecurity/THM/web.json"}],"tags":[{"name":"tryhackme","slug":"tryhackme","count":20,"path":"api/tags/tryhackme.json"},{"name":"web","slug":"web","count":13,"path":"api/tags/web.json"}],"author":{"name":"Satvik.V","slug":"blog-author","avatar":"https://dl.dropbox.com/scl/fi/00hpz9sf96v4gugpvx7t9/profile.jpg?rlkey=yet0g0rb9ofkl806vvhmkjail&st=3rw0pj88&dl=0","link":"https://dl.dropbox.com/scl/fi/00hpz9sf96v4gugpvx7t9/profile.jpg?rlkey=yet0g0rb9ofkl806vvhmkjail&st=3rw0pj88&dl=0","description":"An Aspiring Penetration Tester & a security Enthusiast 🚀 127.0.0.1 / sudo rm -rf / 😁 Dont Drink and Root 👀","socials":{"github":"https://github.com/satvikblog","twitter":"https://twitter.com/anonbash1","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"instagram":{"icon":"fab fa-instagram","link":"https://instagram.com/satvikshetty.v"}}}}},"next_post":{"title":"IDOR - THM Walkthrough","uid":"3e8a6fee12ff22738278818798983478","slug":"THM/WEB/IDOR-THM-Walkthrough","date":"2024-06-04T09:53:27.000Z","updated":"2024-06-04T10:38:16.185Z","comments":true,"path":"api/articles/THM/WEB/IDOR-THM-Walkthrough.json","keywords":null,"cover":"https://tryhackme-images.s3.amazonaws.com/room-icons/92b349206a2901c187e32ad074eae45c.png","text":"Hello Hackers 💌Today we are gonna walkthrough a new room in Web Fundamentals cal...","permalink":"/post/THM/WEB/IDOR-THM-Walkthrough","photos":[],"count_time":{"symbolsCount":"6.5k","symbolsTime":"6 mins."},"categories":[{"name":"cybersecurity","slug":"cybersecurity","count":21,"path":"api/categories/cybersecurity.json"},{"name":"THM","slug":"cybersecurity/THM","count":20,"path":"api/categories/cybersecurity/THM.json"},{"name":"web","slug":"cybersecurity/THM/web","count":13,"path":"api/categories/cybersecurity/THM/web.json"}],"tags":[{"name":"tryhackme","slug":"tryhackme","count":20,"path":"api/tags/tryhackme.json"},{"name":"web","slug":"web","count":13,"path":"api/tags/web.json"}],"author":{"name":"Satvik.V","slug":"blog-author","avatar":"https://dl.dropbox.com/scl/fi/00hpz9sf96v4gugpvx7t9/profile.jpg?rlkey=yet0g0rb9ofkl806vvhmkjail&st=3rw0pj88&dl=0","link":"https://dl.dropbox.com/scl/fi/00hpz9sf96v4gugpvx7t9/profile.jpg?rlkey=yet0g0rb9ofkl806vvhmkjail&st=3rw0pj88&dl=0","description":"An Aspiring Penetration Tester & a security Enthusiast 🚀 127.0.0.1 / sudo rm -rf / 😁 Dont Drink and Root 👀","socials":{"github":"https://github.com/satvikblog","twitter":"https://twitter.com/anonbash1","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"instagram":{"icon":"fab fa-instagram","link":"https://instagram.com/satvikshetty.v"}}}}}}